<!-- api_key: AIzaSyACzDzO49_V7dDFRos1tMxWKktaFJh0dbA -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Islamic battles map</title>
    <meta name="description" content="Early islam battles map">
    <meta name="author" content="IZholdasbayev">

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css" type="text/css">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dosis:300|Open+Sans">

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="//maps.google.com/maps/api/js?key=AIzaSyACzDzO49_V7dDFRos1tMxWKktaFJh0dbA"></script>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/manifest.json">
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->

</head>

<body>
    <div id="map"></div>
    <div class="controls">
        <h3>Sources:</h3>
        <input type="checkbox" class="cb" name="nq" id="nq" title="Nasab Quraysh" onclick="nqsource(this)" checked="true">
        <div class="cbcircle nqcircle"></div> Nasab Quraysh<br>
        <input type="checkbox" class="cb" name="ken" id="ken" title="The Great Arab conquests" onclick="kensource(this)" checked="true">
        <div class="cbcircle kencircle"></div> The Great Arab Conquests
    </div>
    <div class="container">
        <div class="textbox">
            <div class="placeholder">
                <h2>Islamic Battles</h2>
                <br> This website is about islamic battles according to different sources. Such as Nasab Quraysh and The Great Arab Conquests
            </div>
        </div>
    </div>

    <svg class="test" width="960" height="200"></svg>

    <script>
        var test = d3.select(".test"),
            margin = {
                top: 40,
                right: 40,
                bottom: 40,
                left: 40
            },
            width = test.attr("width") - margin.left - margin.right,
            height = test.attr("height") - margin.top - margin.bottom;

        var formatValue = d3.format(",d");

        var x = d3.scaleLog()
            .rangeRound([0, width]);

        var g = test.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.csv("flare.csv", type, function(error, data) {
            if (error) throw error;

            x.domain(d3.extent(data, function(d) {
                return d.value;
            }));

            var simulation = d3.forceSimulation(data)
                .force("x", d3.forceX(function(d) {
                    return x(d.value);
                }).strength(1))
                .force("y", d3.forceY(height / 2))
                .force("collide", d3.forceCollide(4))
                .stop();

            for (var i = 0; i < 120; ++i) simulation.tick();

            g.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).ticks(20, ".0s"));

            var cell = g.append("g")
                .attr("class", "cells")
                .selectAll("g").data(d3.voronoi()
                    .extent([
                        [-margin.left, -margin.top],
                        [width + margin.right, height + margin.top]
                    ])
                    .x(function(d) {
                        return d.x;
                    })
                    .y(function(d) {
                        return d.y;
                    })
                    .polygons(data)).enter().append("g");

            cell.append("circle")
                .attr("r", 3)
                .attr("cx", function(d) {
                    return d.data.x;
                })
                .attr("cy", function(d) {
                    return d.data.y;
                });

            cell.append("path")
                .attr("d", function(d) {
                    return "M" + d.join("L") + "Z";
                });

            cell.append("title")
                .text(function(d) {
                    return d.data.id + "\n" + formatValue(d.data.value);
                });
        });

        function type(d) {
            if (!d.value) return;
            d.value = +d.value;
            return d;
        }
    </script>

    <!-- Custom js files -->
    <!-- <script src="js/test.js"></script> -->
    <script src="js/mouse_events.js"></script>
    <script src="js/map.js"></script>
    <script src="js/main.js"></script>
</body>

</html